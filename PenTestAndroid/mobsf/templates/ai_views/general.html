{% extends "base/base_layout.html" %}
{% load custom_filters %}
   {% load static %}
    {% block sidebar_option %}
      sidebar-mini
     {% endblock %}
    {% block extra_css %}
    <link href="{% static "adminlte/plugins/sweetalert2/sweetalert2.min.css" %}" rel="stylesheet">
    <!-- DataTables -->
    <link rel="stylesheet" href="{% static "adminlte/plugins/datatables-bs4/dataTables.bootstrap4.min.css" %}">
    <!-- Include Bootstrap CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
     <style type="text/css" media="print">
        @page { size: landscape; }
        @media print {
          .btn, #scan_options  {
            display: none;
          }
        }
    </style>
    <style>
          #app_icon{
            width: 64px;
            height: 64px;
          }
          .accordion-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          .accordion-button > div {
              flex: 1;  /* Make each section take equal space */
              text-align: center;
          }
          pre {
              white-space: pre-wrap; /* Allows natural breaks at whitespace and forced breaks at the edge of the container */
              word-wrap: break-word; /* Ensure long words do not cause overflow */
              overflow-x: auto; /* Adds horizontal scrollbar if needed */
          }
          table {
              width: 100%;
              border-collapse: separate; /* Allows spacing between cells */
              border-spacing: 0; /* Removes spacing for a neater appearance */
              box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
              margin: 20px 0; /* Adds space around the table */
          }

          th, td {
              border-bottom: 1px solid #ccc; /* Lighter border color */
              padding: 12px 15px; /* More padding for a better look */
              text-align: left;
              background-color: #fff; /* White background for cells */
          }

          th {
              background-color: #f9f9f9; /* A very light grey for headers */
              color: #333; /* Dark grey color for text */
              font-weight: bold; /* Makes header text bold */
              border-top: 3px solid #ccc; /* Solid top border for headers */
              border-bottom: 2px solid #ccc; /* Thicker bottom border for headers */
              text-transform: uppercase; /* Optional: Makes header text uppercase */
          }

          tr:nth-child(even) {
              background-color: #f2f2f2; /* Zebra stripes for rows */
          }

          tr:hover {
              background-color: #e8f4ff; /* Light blue background on row hover */
          }

          /* Rounded corners for the top left and right of the table */
          th:first-child {
              border-top-left-radius: 8px;
          }

          th:last-child {
              border-top-right-radius: 8px;
          }
          .my-div {
            margin-left: 280px;
          }
    </style>
    {% endblock %}
    {% block sidebar %}
    <!-- Main Sidebar Container -->
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="info">
          <a href="#" class="d-block">Automatic AI Analyzer</a>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column nav-child-indent" data-widget="treeview" role="menu" data-accordion="false">
          
          <li class="nav-item">
            <a href="#information" class="nav-link">
              <i class="nav-icon fas fa-info-circle"></i>
              <p>
                Information
              </p>
            </a>
          </li>
          
          <li class="nav-item has-treeview">
            <a href="#" class="nav-link">
                <i class="fas fa-user-secret nav-icon"></i>
              <p>
                Exported
                <i class="fas fa-angle-left right"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
             <li class="nav-item">
                <a href="#network_security" class="nav-link">
                  <i class="nav-icon fas fa-lock"></i>
                  <p>
                    Activity
                  </p>
                </a>
              </li>
              <li class="nav-item">
                <a href="#manifest" class="nav-link">
                  <i class="fas fa-search nav-icon"></i>
                  <p>Content Provider</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="#code_analysis" class="nav-link">
                  <i class="fa fa-code nav-icon"></i>
                  <p>Broadcast Receiver</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="#niap_analysis" class="nav-link">
                  <i class="fa fa-id-badge nav-icon"></i>
                  <p>Service</p>
                </a>
              </li>
            </ul>
          </li>

          <li class="nav-item has-treeview">
            <a href="#" class="nav-link">
              <i class="nav-icon fa fa-bug"></i>
              <p>
                Filesystem
                <i class="fas fa-angle-left right"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="#serverlocations" class="nav-link">
                  <i class="fas fa-globe-asia nav-icon"></i>
                  <p>Runtime Logs</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="#malware_check" class="nav-link">
                  <i class="fab fa-searchengin nav-icon"></i>
                  <p>Sandbox</p>
                </a>
              </li>
            </ul>
          </li>

           <li class="nav-item has-treeview">
            <a href="#" class="nav-link">
              <i class="nav-icon fa fa-plus"></i>
              <p>
                Rules Scan
                <i class="fas fa-angle-left right"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="#urls" class="nav-link">
                  <i class="fas fa-globe nav-icon"></i>
                  <p>Logs</p>
                </a>
              </li>
            </ul>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="#urls" class="nav-link">
                  <i class="fas fa-globe nav-icon"></i>
                  <p>Vulnerabilities</p>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
{% endblock %}
{% block content %}
  <!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <div class="content-header">
  <!--
    <div class="container-fluid">
      <div class="row mb-2">
        <div id="mobsf_header" align="center">
        </div>
      </div>
    </div>-->
  </div>
  <!-- /.content-header -->


 <!-- Main content -->
<a id="information" class="anchor"></a>
<section class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
        
          <div class="card">
            <div class="card-body">
              <h5 class="card-title"></h5>
                <div class="row">
                <div class="col-2">
                  <p><strong><i class="fas fa-check-double"></i> AI ANALYZER</strong></p>
                  <p> <a href="{% url 'ai_analyzer_start' checksum=md5 %}" class="btn btn-success btn-bg" role="button"><i class="fas fa-user-shield"></i> Start AI Scan</a></p>

                </div>
                <div class="col-6">
                  <p><strong><i class="fas fa-box-open"></i> FILE INFORMATION </strong></p>                         
                  <span class="badge bg-primary">Size</span>
                  {{ size }}<br/>
                  <span class="badge bg-primary">MD5</span>
                  {{ md5 }}<br/>
                  <span class="badge bg-primary">SHA1</span>
                  {{ sha1 }}<br/>           
                  <span class="badge bg-primary">SHA256</span>
                  {{ sha256 }}<br/>
                </div>
                <div class="col-4">
                  <p><strong><i class="fas fa-info"></i> APP INFORMATION </strong></p>                                       
                  <span class="badge bg-primary">App Name</span>
                  {{ app_name }}<br/>                                   
                </div>    
              </div>

            </div>
          </div>
          </div>
          
      <!-- /.col -->
      <!-- row and container-->
      </div>
  </div>

  <!-- Boxes -->
   <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
        
          <div class="card">
            <div class="card-body">
              <h5 class="card-title"></h5>
                <div class="row">
                        <!-- Boxes columns -->
                      <div class="col-12 col-sm-6 col-md-3">
                        <!-- small box -->
                        <div class="small-box bg-info">
                          <div class="inner">
                            <h3>{{ act_cnt }}</h3>

                            <p>EXPORTED ACTIVITIES</p>
                          </div>
                          <div class="icon">
                            <i class="fa fa-language"></i>
                          </div>
                          <a href="#activities" class="small-box-footer">View <i class="fas fa-arrow-circle-down"></i></a>
                        </div>
                      </div>
                      <!-- ./col -->
                      <div class="col-12 col-sm-6 col-md-3">
                        <!-- small box -->
                        <div class="small-box bg-success">
                          <div class="inner">
                            <h3>{{ pro_cnt }}</h3>

                            <p>EXPORTED SERVICES</p>
                          </div>
                          <div class="icon">
                            <i class="fa fa-cogs"></i>
                          </div>
                          <a href="#services" class="small-box-footer">View <i class="fas fa-arrow-circle-down"></i></a>
                        </div>
                      </div>
                      <!-- ./col -->
                      <div class="col-12 col-sm-6 col-md-3">
                        <!-- small box -->
                        <div class="small-box bg-warning">
                          <div class="inner">
                            <h3>{{ rcv_cnt }}</h3>

                            <p>EXPORTED RECEIVERS</p>
                          </div>
                          <div class="icon">
                            <i class="fa fa-assistive-listening-systems"></i>
                          </div>
                          <a href="#receivers" class="small-box-footer">View <i class="fas fa-arrow-circle-down"></i></a>
                        </div>
                      </div>
                      <!-- ./col -->
                      <div class="col-12 col-sm-6 col-md-3">
                        <!-- small box -->
                        <div class="small-box bg-danger">
                          <div class="inner">
                            <h3>{{ com_cnt }}</h3>

                            <p>EXPORTED PROVIDERS</p>
                          </div>
                          <div class="icon">
                            <i class="fa fa-database"></i>
                          </div>
                          <a href="#providers" class="small-box-footer">View <i class="fas fa-arrow-circle-down"></i></a>
                        </div>
                      <!-- /.row -->
                    </div><!-- /.container-fluid -->
                        
                      </div>
                </div>
            </div>
          </div>

        </div>
      </div>
    </div>  
  
  <!-- =========================end information==================================== -->
  <div class="my-div">
    <h1>Exported Components Scan Results</h1>
    <div class="accordion" id="findingsAccordion">
        {% for activity, details in findings.items %}
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" aria-controls="collapse{{ forloop.counter }}">
                    <div>{{ activity }}</div>
                    <div>{{ details.vulnerable|yesno:"Vulnerable,Not Vulnerable" }}</div>
                    <div>{{ details.issues|length }} issues</div>
                </button>
            </h2>
            <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#findingsAccordion">
                <div class="accordion-body">
                    <p><strong>Vulnerable:</strong> {{ details.vulnerable }}</p>
                    <h3>Issues:</h3>
                    <ul>
                        {% for issue in details.issues %}
                            <li>{{ issue }}</li>
                        {% endfor %}
                    </ul>
                    <h3>Exploits:</h3>
                    <ul>
                        {% for exploit in details.exploits %}
                            <li>{{ exploit }}</li>
                        {% endfor %}
                    </ul>
                    <h3>Component Definition:</h3>
                    <pre>{{ details.component_definition }}</pre>
                    <h3>Component Code:</h3>
                    <pre>{{ details.component_code|prettify_java_code }}</pre>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    <hr>
    <h1>Filesystem Scan Results</h1>
    <h3>Runtime Logs Detected Secrets</h3>
    <p>{{ raw_log|csv_to_new_line }}</p>
    <br>
    <h3>Filesystem Detected Secrets</h3>
    <table>
        <thead>
            <tr>
                <th>File Name</th>
                <th>Detected Secrets</th>
            </tr>
        </thead>
        <tbody>
            {% for key, value in filesystem.items %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ value }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <hr>
    <h1>Rule Scan Result</h1>
    <h3>Rules Logs</h3>
    <table>
      <thead>
          <tr>
              <th>File</th>
              <th>Detected Secrets</th>
          </tr>
      </thead>
      <tbody>
        {% for secret in rules_log %}
              <tr>
                  <td>{{ secret.file_path }}</td>
                  <td>{{ secret.logged_secrets }}</td>
              </tr>
        {% endfor %}
      </tbody>
  </table>
  <h3>Rules Vulnerabilities</h3>
  <table>
    <thead>
        <tr>
            <th>Rule ID</th>
            <th>Rule Definition</th>
            <th>File</th>
            <th>Vulnerable</th>
            <th>Issue Description</th>
            <th>Vulnerable Code</th>
        </tr>
    </thead>
    <tbody>
      {% for finding in rules_vuln %}
            <tr>
                <td>{{ finding.rule_id }}</td>
                <td>{{ finding.rule_message }}</td>
                <td>{{ finding.file_path }}</td>
                <td style="color: {% if finding.vulnerable %}red{% else %}green{% endif %};">
                  {% if finding.vulnerable %}Vulnerable{% else %}Not Vulnerable{% endif %}
                </td>
                <td>{{ finding.issue }}</td>
                <td>{{ finding.snippet }}</td>
            </tr>
      {% endfor %}
    </tbody>
</table>
  </div>
</div>

</section>
{% endblock %}
<!--end new UI-->
{% block extra_scripts %}
<script src="{% static "adminlte/plugins/sweetalert2/sweetalert2.min.js" %}"></script>
<!-- Include Bootstrap JavaScript from CDN -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static "others/js/suppression.js" %}"></script>
<script>

  // Remove rescan parameter
  window.history.replaceState({}, '', window.location.pathname);

  // Globals
  const hash = '{{md5}}'

  $(function () {
    // Datatable
    $('table').DataTable({
      "paging": true,
      "lengthChange": false,
      "searching": true,
      "ordering": true,
      "info": true,
      "autoWidth": true,
      "responsive": true,
    });
  });
  // Navbar Active
    $(".nav-link").on("click", function() {
    $(".nav-link").removeClass("active");
    $(this).addClass("active");
  });
</script>
{% endblock %}
